SELECT
    name,
    way_area::bigint AS area,
    osm_id AS __id__,
    "building:part",
    NULL AS kind,
    building,
    amenity,
    shop,
    tourism,
    "building:levels",
    "building:min_levels",
    height,
    min_height,
    layer,
    tags->'location' AS location,
    {% filter geometry %}way{% endfilter %} AS __geometry__,
{% if zoom >= 15 %}
    "roof:color" AS roof_color,
    "roof:material" AS roof_material,
    "roof:shape" AS roof_shape,
    "roof:height" AS roof_height,
    "roof:orientation" AS roof_orientation,
{% endif %}
{% if zoom >= 17 %}
    "addr:housenumber" AS addr_housenumber,
    "addr:street" AS addr_street,
{% endif %}
    %#tags AS tags

FROM
    planet_osm_polygon

WHERE

{% if zoom < 15 %}
    building IS NOT NULL
  {% if zoom == 13 %}
    AND way_area::bigint > 1600
  {% elif zoom == 14 %}
    AND way_area::bigint > 100
  {% endif %}
{% else %}
    mz_calculate_is_building_or_part(building, "building:part") = TRUE
  {% if zoom == 15 %}
    AND way_area::bigint > 100
  {% elif zoom == 16 %}
    AND way_area::bigint > 25
  {% endif %}
{% endif %}

    AND {{ bounds|bbox_filter('way') }}

{% if zoom >= 17 %}

UNION ALL

SELECT
    name,
    NULL AS area,
    osm_id AS __id__,
    NULL AS "building:part",
    'address' AS kind,
    NULL AS building,
    NULL AS amenity,
    NULL AS shop,
    NULL AS tourism,
    NULL AS "building:levels",
    NULL AS "building:min_levels",
    NULL AS height,
    NULL AS min_height,
    NULL AS layer,
    NULL AS location,
    {% filter geometry %}way{% endfilter %} AS __geometry__,
    NULL AS roof_color,
    NULL AS roof_material,
    NULL AS roof_shape,
    NULL AS roof_height,
    NULL AS roof_orientation,
    "addr:housenumber" AS addr_housenumber,
    "addr:street" AS addr_street,
    %#tags AS tags

FROM
    planet_osm_point

WHERE

    "addr:housenumber" IS NOT NULL AND
    {{ bounds|bbox_filter('way') }}

{% endif %}
